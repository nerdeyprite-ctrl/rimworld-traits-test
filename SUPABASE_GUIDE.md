
# Supabase Setup Guide for Statistics

이 가이드는 변방계 정착민 테스트의 **통계 기능(참여자 수, MBTI/특성 분포)**을 활성화하기 위한 Supabase 연동 방법을 안내합니다.

## 1. Supabase 프로젝트 생성
1. [Supabase](https://supabase.com/)에 접속하여 'Start your project'를 클릭하고 로그인합니다.
2. 'New Project'를 클릭하여 새 프로젝트를 생성합니다. (Name: `rimworld-test` 등 자유롭게)
3. Region은 `Seoul` 또는 사용자와 가까운 곳을 선택합니다.
4. Database Password를 설정하고 프로젝트가 생성될 때까지 기다립니다.

## 2. 테이블 생성 (SQL Editor)
1. 왼쪽 메뉴에서 **SQL Editor** 아이콘을 클릭합니다.
2. 'New query'를 클릭하여 빈 쿼리 창을 엽니다.
3. 아래 SQL 코드를 복사하여 붙여넣고 `Run` 버튼을 클릭합니다.

```sql
-- 결과 저장 테이블 생성
create table test_results (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  mbti text,
  traits jsonb,
  backstory_childhood jsonb,
  backstory_adulthood jsonb,
  skills jsonb
);

-- RLS(Row Level Security) 활성화
alter table test_results enable row level security;

-- 누구나 데이터를 저장할 수 있도록 허용 (Insert)
create policy "Allow anonymous inserts"
on test_results for insert
to anon
with check (true);

-- 누구나 통계 데이터를 조회할 수 있도록 허용 (Select)
create policy "Allow anonymous selects"
on test_results for select
to anon
using (true);
```

## 3. 환경 변수 설정 (.env.local)
1. Supabase 대시보드에서 왼쪽 하단의 **Settings (톱니바퀴) > API** 메뉴로 이동합니다.
2. `Project URL`과 `anon` `public` 키를 확인합니다.
3. 프로젝트 루트의 `.env.local` 파일(없으면 생성)에 다음 내용을 추가합니다.

```env
NEXT_PUBLIC_SUPABASE_URL=YOUR_SUPABASE_PROJECT_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
```
(`YOUR_...` 부분을 실제 값으로 변경하세요)

## 4. 확인
1. 프로젝트를 재실행합니다 (`npm run dev`).
2. 테스트를 완료하고 결과 페이지가 나오면 자동으로 데이터가 저장됩니다.
3. `/stats` 페이지 (`http://localhost:3000/stats`)로 접속하여 통계가 제대로 나오는지 확인합니다.
   (초기 데이터가 없으면 차트가 비어있을 수 있습니다. 테스트를 몇 번 진행해보세요.)
